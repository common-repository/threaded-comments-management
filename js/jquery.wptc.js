var wptcObject,commentReply;(function(c){var b={historyStorageItemsName:"wptc-history",historyButtonsId:"wptc-history",maxSizeOfHistory:50,dropzoneStorageItemsName:"wptc-dropzone",dropzoneId:"wptc-dropzone",inDropzoneClass:"wptc-in-dropzone",dropOverClass:"wptc-drop-over",draggedClass:"wptc-dragged",highlightTime:3000,maxSizeOfDropzone:20,maxShownInDropzone:10,numberOfCharactersShown:60,bulkMvToDropzone:"tcMvToDropzone",bulkMvTo:"tcMvTo",bulkRmFromToDropzone:"tcRmFromDropzone",bulkMvToRoot:"tcMvToRoot",};c.fn.wptc=function(){if(typeof this.data("wptcCommentObject")=="undefined"){wptcObject.createComment(this)}return this.data("wptcCommentObject")};c.wptc=function(){c("#the-comment-list tr").each(function(){var d=c.map(c(this).attr("class").split(" "),function(e){if(e.substr(0,5)=="depth"){return e.substr(6)}});if(d>1){c(this).hide()}});c("#the-list tr").each(function(){c(this).droppable({scope:"wptc-comments",drop:function(d,e){e.draggable.wptc().dropTo(this,"post");c(this).removeClass(b.dropOverClass)},over:function(){c(this).addClass(b.dropOverClass)},out:function(){c(this).removeClass(b.dropOverClass)},})});return new a()};var a=function(){if(window.pagenow=="comment"){d();return null}else{if(window.pagenow!="edit-post"&&window.pagenow!="edit-page"&&window.pagenow!="wp-tc-edit-comments"){return null}}var l=c(this)[0];this.wptcCommentsStorage=c("<table />").appendTo("body").hide();this.wptcCommentsStorageDropzone=c("<ul />").appendTo("body").hide();this.wptcDropzone=new f(l);this.wptcHistory=new j(l);c("#the-comment-list tr").each(function(){new h(c(this).attr("id").substr(8),l)});this.wptcDropzone.restore();this.wptcHistory.restore();this.expandingMinimum=20;i();d();this.createComment=function(n){new h(n.attr("id").substr(8),l)};function h(o,w,y){var u=c(this)[0];var t={status:null,children:null,parents:null,remote:false,};var s={commentId:0,commentParentId:0,commentParentAuthor:"",defaults:true,};var B={history:"",list:"",};function z(){if(typeof(o)=="object"){s=o}else{s.commentId=o}var D=c("#comment-"+s.commentId);var E=false;var C="";if(D.length){C=D.get();E=true}if(!E){C=x();if(C){E=true}}c.when(e({c:u.getData("commentId"),single:true},{dataFilter:function(G,F){G=JSON.parse(G);s=h.convertDataForClient(G[0]);return JSON.stringify(s)}},E)).done(function(F){if(!C){s.defaults=false;t.remote=true;s=F;C=x()}if(s.defaults){s=h.readDataFromHTML(C)}if(D.length==0){B.list=c(C).appendTo(w.wptcCommentsStorage)}else{B.list=D}B.dropzone=c(w.wptcDropzone.generateHTML(u)).appendTo(w.wptcCommentsStorageDropzone);B.list.data("wptcCommentObject",u);B.dropzone.data("wptcCommentObject",u);u.draggabify().droppabify();B.list.find("a.tc-show-more").live("click",function(){u.expandSubthread()});B.list.find("a.tc-show-less").live("click",function(){u.collapseSubthread()});if(y){y(u,B.list)}})}h.convertDataForClient=function(C,D){return{commentId:C.comment_ID,commentAuthorAvatar:C.comment_author_avatar,commentAuthorEmail:C.comment_author_email,commentAuthorUrl:C.comment_author_url,commentAuthor:C.comment_author,commentText:C.comment_content,commentParentId:C.comment_parent,commentParentAuthor:(C.comment_parent_author)?C.comment_parent_author:"",commentDate:C.comment_date,commentDateFormatted:(C.comment_date_formatted)?C.comment_date_formatted:C.comment_date,commentDepth:(C.comment_depth)?parseInt(C.comment_depth):1,commentNoc:(C.number_of_children)?parseInt(C.number_of_children):0,commentStatus:C.comment_approved,commentWithSubthread:true,commentWpNonceMove:C.wp_nonce_move,commentWpNonceDel:C.wp_nonce_del,commentWpNonceApprove:C.wp_nonce_approve,postId:C.comment_post_ID,commentRemote:(D)?D:false,commentAuthorIP:C.comment_author_IP,defaults:false,}};h.readDataFromHTML=function(K){var M=c(K);var W=s.commentId;var Q=M.find("td.comment .comment-parent");var I=M.find(".column-author strong img").attr("src");var S=M.find("td.comment .author-url").text();var V=M.find("td.comment .author-email").text();var U=M.find("td.comment .author").text();var T=M.find("td.comment .comment").val();var O=(Q[0])?c.map(Q.attr("class").split(" "),function(X){if(X.substr(0,17)=="comment-parent-id"){return X.substr(18)}})[0]:0;var P=(Q[0])?Q.text():"";var H=M.find("td.comment .comment_status").text();var D=M.find(".comment-submitted-on").text();var G=D;var R=c.map(M.attr("class").split(" "),function(X){if(X.substr(0,5)=="depth"){return X.substr(6)}})[0];var E=parseInt(M.find(".comment-noc").text());var N=c("#comment-tc-move-nonce-"+W).text();var F=0;F=c("#comments-form input[name='p']");if(F.length){F=F.val()}else{var J=M.find(".post-com-count");var L=J.attr("href").search(/p=/i)+2;F=parseInt(J.attr("href").substr(L))}if(!E){E=0}var C={commentId:W,commentAuthorAvatar:I,commentAuthorEmail:V,commentAuthorUrl:S,commentAuthor:U,commentText:T,commentParentId:O,commentParentAuthor:P,commentDate:D,commentDateFormatted:G,commentDepth:parseInt(R),commentNoc:E,commentStatus:H,commentWithSubthread:true,commentWpNonceMove:N,postId:F,defaults:false,commentRemote:false,};return C};this.draggabify=function(){B.dropzone.draggable({revert:true,scope:"wptc-comments",cursor:"move",disabled:false,distance:10,start:function(){c(this).addClass(b.draggedClass)},stop:function(){c(this).removeClass(b.draggedClass)},}).addClass("wptc-draggable");B.list.draggable({revert:true,scope:"wptc-comments",cursor:"move",distance:10,helper:function(E){var C=c(E.target).closest("tr").clone(true);var D=c(E.target).closest("tr").wptc().getData("commentId");C.attr("id","");return c("<div class='wptc-drag-comment wptc-dragged'><table class='widefat comments'></table></div>").find("table").append(C).end().appendTo("body")},start:function(D){var C=c(D.target).closest("tr");c("<tr id='wptc-mobile-dropzone' class='wptc-special-drop'><td></td><td>"+objectL10n.dropzone+"</td><td></td></tr>").hide().insertBefore(C).fadeIn("slow");if(C.wptc().getData("commentParentId")){c("<tr id='wptc-mobile-rootzone' class='wptc-special-drop'><td></td><td>"+objectL10n.rootTheComment+"</td><td></td></tr>").hide().insertAfter(C).fadeIn("slow")}c("#wptc-mobile-dropzone").droppable({scope:"wptc-comments",drop:function(E,F){F.draggable.wptc().dropTo(null,"dropzone");c("#wptc-mobile-dropzone, #wptc-mobile-rootzone").fadeOut("slow",function(){c(this).remove()})},over:function(){c(this).addClass(b.dropOverClass)},out:function(){c(this).removeClass(b.dropOverClass)},});c("#wptc-mobile-rootzone").droppable({scope:"wptc-comments",drop:function(E,F){F.draggable.wptc().dropTo(null,"root");c("#wptc-mobile-dropzone, #wptc-mobile-rootzone").fadeOut("slow",function(){c(this).remove()})},over:function(){c(this).addClass(b.dropOverClass)},out:function(){c(this).removeClass(b.dropOverClass)},})},stop:function(D){var C=c(D.target).closest("tr");c("#wptc-mobile-dropzone, #wptc-mobile-rootzone").fadeOut("slow",function(){c(this).remove()})},disabled:false,}).addClass("wptc-draggable");return this};this.dedraggabify=function(C){B[C].draggable("option","disabled",true).removeClass("wptc-draggable");return this};this.droppabify=function(){B.list.droppable({scope:"wptc-comments",drop:function(C,D){D.draggable.wptc().dropTo(u,"comment");D.draggable.wptc().jq().removeClass(b.dropOverClass);c(this).removeClass(b.dropOverClass)},over:function(){c(this).addClass(b.dropOverClass)},out:function(){c(this).removeClass(b.dropOverClass)},disabled:false,}).addClass("wptc-droppable");return this};this.dedroppabify=function(){B.list.droppable("option","disabled",true).removeClass("wptc-droppable");return this};this.getData=function(C){if(!C){return s}else{return s[C]}};this.setData=function(D,C){return s[D]=C};function n(C){if(!C){B[t.status].show()}else{B[C].show()}return this}function v(C){if(!C){B[t.status].hide()}else{B[C].hide()}return this}this.dropTo=function(D,C){u.moveTo(D,C)};this.drop=function(C){u.move(comment,C)};this.move=function(D,C){D.moveTo(u,C);return this};this.moveTo=function(L,N){if(N=="dropzone"){w.wptcDropzone.put(u);u.setProperty("status","dropzone");u.jq().draggable("option","disabled",true)}else{if(N=="root"){v("list");var M=0;var K="";var H=u.getData("postId");var P=1-parseInt(s.commentDepth);var C=u.children().length+1;var E=s.postId;var O=s.commentParentId;m(s.commentId,M,H,u.getData("commentWpNonceMove"));c.each(u.parents(),function(Q,R){R.setProperty("children",null);R.fixChildren(-C)});u.setData("commentParentId",M);u.setData("commentParentAuthor",K);u.setData("postId",H);q();var D=u.children();B.list.addClass("wptc-inspected");setTimeout(function(){B.list.removeClass("wptc-inspected")},b.highlightTime);u.fixDepth(P);c.each(D,function(Q,R){R.fixDepth(P);R.setProperty("parents",null);R.jq().addClass("wptc-inspected-thread");setTimeout(function(){R.jq().removeClass("wptc-inspected-thread")},b.highlightTime)});var J=false;c("tr.depth-1:not(.wptc-special-drop)",theList).each(function(){var X=c(this).wptc();var U=u.getData("commentDateFormatted").split(" ");var Q=U[0].split("/");U=U[2].split(":");var T=new Date(Q[0],Q[1]-1,Q[2],U[0],U[1],0);var W=X.getData("commentDateFormatted").split(" ");var S=W[0].split("/");W=W[2].split(":");var V=new Date(S[0],S[1]-1,S[2],W[0],W[1],0);if(V.getTime()<T.getTime()){J=true;var R=B.list.insertBefore(this);c.each(D,function(Y,Z){R=Z.jq().insertAfter(R)});return false}});if(!J){var G=B.list.prependTo(c("#the-comment-list"));c.each(D,function(Q,R){G=R.jq().insertAfter(G)})}t.parents=null;w.wptcHistory.put({commentId:s.commentId,oldParentId:O,oldPostId:E,newParentId:M,newPostId:H,commentWpNonceMove:u.getData("commentWpNonceMove"),});if(t.status=="dropzone"){w.wptcDropzone.remove(this);t.status="list";u.jq().draggable("option","disabled",false)}n("list")}else{if(N=="post"){var M=0;var K="";var H=c(L).attr("id").substr(5);var P=1-s.commentDepth;var E=s.postId;var O=s.commentParentId;m(s.commentId,M,H,u.getData("commentWpNonceMove"));u.setData("commentParentId",M);u.setData("commentParentAuthor",K);u.setData("postId",H);q();u.fixDepth(P);if(H!=E){g(E,H,u.getData("commentNoc")+1)}t.parents=null;w.wptcHistory.put({commentId:s.commentId,oldParentId:O,oldPostId:E,newParentId:M,newPostId:H,commentWpNonceMove:u.getData("commentWpNonceMove"),});if(t.status=="dropzone"){w.wptcDropzone.remove(this);t.status="list";u.jq().draggable("option","disabled",false)}}else{v("list");var M=L.getData("commentId");var K=L.getData("commentAuthor");var H=L.getData("postId");var C=u.getData("commentNoc")+1;var P=L.getData("commentDepth")-s.commentDepth+1;var E=s.postId;var O=s.commentParentId;if(M==u.getData("commentId")){n("list");return this}var D=u.children();var I=false;c.each(D,function(Q,R){if(R.getData("commentId")==u.getData("commentId")){I=true;return false}});if(I){n("list");return this}var F=m(s.commentId,M,H,u.getData("commentWpNonceMove"));if(!this.getProperty("remote")){c.each(u.parents(),function(Q,R){R.setProperty("children",null);R.fixChildren(-C)})}u.setData("commentParentId",M);u.setData("commentParentAuthor",K);u.setData("postId",H);q();var D=u.children();u.fixDepth(P);c.each(D,function(Q,R){R.fixDepth(P);R.setProperty("parents",null)});D=u.children();var G=B.list.insertAfter(L.jq("list")).addClass("wptc-inspected");setTimeout(function(){B.list.removeClass("wptc-inspected")},b.highlightTime);c.each(D,function(Q,R){G=R.jq().insertAfter(G).addClass("wptc-inspected-thread");setTimeout(function(){R.jq().removeClass("wptc-inspected-thread")},b.highlightTime)});u.setProperty("parents",null);c.each(u.parents(),function(Q,R){R.setProperty("children",null);R.fixChildren(C)});if(H!=E){g(E,H,u.getData("commentNoc")+1);p(L)}w.wptcHistory.put({commentId:s.commentId,oldParentId:O,oldPostId:E,newParentId:M,newPostId:H,commentWpNonceMove:u.getData("commentWpNonceMove"),});if(this.getProperty("remote")){F.done(e({action:"get-comment-subthread",single:"false",c:s.commentId,returncommentsubthread:"true",},{dataFilter:function(T,S){T=JSON.parse(T);T=T[0];var Q=[];for(var R=1;R<T.length;R++){Q.push(h.convertDataForClient(T[R]))}return JSON.stringify(Q)},}).done(function(Q){console.debug(B.list);if(Q){var R=u.jq();for(var S=0;S<Q.length;S++){var T=new h(Q[S],w,function(V,U){R=U.insertAfter(R);V.setProperty("children",null);V.setProperty("parents",null)})}u.setProperty("children",null)}}))}if(u.getProperty("status")=="dropzone"){w.wptcDropzone.remove(u);u.setProperty("status","list");u.jq().draggable("option","disabled",false)}n("list")}}}return this};this.getProperty=function(C){if(!C){return t}else{return t[C]}};this.setProperty=function(D,C){return t[D]=C};this.children=function(){var C=B.list.nextUntil("tr.depth-"+u.getData("commentDepth"),"tr:not(.wptc-special-drop)").map(function(D,F){var E=c(F).data("wptcCommentObject");if(E.getData("commentDepth")>u.getData("commentDepth")){return E}});t.children=C;return t.children};z();function q(){var E="<span class='comment-parent-span'> | "+objectL10n.inReplyTo+" <a class='comment-parent comment-parent-id-"+s.commentParentId+"' href='"+objectL10n.rootURL+"?p="+s.postId+"#comment-"+s.commentParentId+"'>"+s.commentParentAuthor+"</a>.</span>";var D=B.list.find(".column-comment .submitted-on");if(s.commentParentId){var C=D.find(".comment-parent-span");if(C.length){C.show().html(E)}else{D.append(E)}}else{D.find(".comment-parent-span").hide()}return this}function p(D){var C=D.jq().find("td.response.column-response").html();u.jq().find("td.response.column-response").html(C);return this}this.fixChildren=function(F){s.commentNoc+=parseInt(F);var H=parseInt(s.commentDepth)+1;var G="<span class='comment-noc-span'> | "+objectL10n.has+" <span class='comment-noc'>";if(parseInt(s.commentNoc)>1){G+=s.commentNoc+"</span> "+objectL10n.pReplies+".</span>"}else{G+=" 1 </span> "+objectL10n.sReplies+".</span>"}var E="<span class='expand'><a class='tc-show-less' href='#depth-"+H+"'>"+objectL10n.collapse+"</a> | </span>";var C=B.list.find(".column-comment .submitted-on");if(s.commentNoc){var D=C.find(".comment-noc-span");var I=B.list.find(".column-comment .row-actions");if(D.length){D.show().html(G);I.find(".expand").show().find("a").attr("href","#depth-"+H)}else{C.append(G);I.prepend(E)}}else{C.find(".comment-noc-span").hide();B.list.find(".column-comment .row-actions .expand").hide()}return this};this.fixDepth=function(C){var D=parseInt(s.commentDepth);s.commentDepth=parseInt(D)+parseInt(C);if(B.list){B.list.find(".depth-"+D).andSelf().removeClass("depth-"+D).addClass("depth-"+s.commentDepth)}return this};function x(D){var C=true;if(D===false){C=D}if(s.defaults){return null}var E=parseInt(s.commentDepth)+1;var F="<tr id='comment-"+s.commentId+"' class='approved depth-"+s.commentDepth+" droppable draggable'><th scope='row' class='check-column'><input type='checkbox' name='delete_comments[]' value='"+s.commentId+"'></th><td class='author column-author'><strong>"+s.commentAuthorAvatar+s.commentAuthor+"</strong><br><a href='mailto:"+s.commentAuthorEmail+"'>"+s.commentAuthorEmail+"</a><br><a href='edit-comments.php?s="+s.commentAuthorIP+"&amp;mode=detail'>"+s.commentAuthorIP+"</a></td><td class='comment column-comment'><div class='depth-indicator depth-"+s.commentDepth+"'><div class='depth-padding'><div class='submitted-on'>"+objectL10n.submittedOn+" <a href='"+objectL10n.rootURL+"?p="+s.postId+"#comment-"+s.commentId+"'>"+s.commentDateFormatted+"</a>";if(s.commentParentId){F+='<span class="comment-parent-span" > | '+objectL10n.inReplyTo+' <a href="'+objectL10n.rootURL+"?p="+s.postId+"#comment-"+s.commentParentId+'">'+s.commentParentAuthor+"</a>.</span>"}if(parseInt(s.commentNoc)==1){F+=" | "+objectL10n.has+" <span class='comment-noc'>"+s.commentNoc+"</span>"+objectL10n.sReplies+"."}else{if(parseInt(s.commentNoc)>1){F+=" | "+objectL10n.has+" <span class='comment-noc'>"+s.commentNoc+"</span>"+objectL10n.pReplies+"."}}F+=" </div><p>"+s.commentText+"</p><div id='inline-"+s.commentId+"' class='hidden'><textarea class='comment' rows='1' cols='1'>"+s.commentText+"</textarea><div class='author-email'>"+s.commentAuthorEmail+"</div><div class='author'>"+s.commentAuthor+"</div><div class='author-url'></div><div class='comment_status'>1</div></div><div class='row-actions'>";if(C&&s.commentNoc){F+='<span class="expand"><a class="tc-show-less" href="#depth-'+E+'">'+objectL10n.expand+"</a></span>"}F+='<span class="approve"><a href="comment.php?c='+s.commentId+"&amp;action=approvecomment&amp;"+s.commentWpNonceApprove+'" class="dim:the-comment-list:comment-'+s.commentId+':unapproved:e7e7d3:e7e7d3:new=approved vim-a" title="'+objectL10n.approveThisComment+'">'+objectL10n.approve+'</a></span><span class="unapprove"> | <a href="comment.php?c='+s.commentId+"&amp;action=unapprovecomment&amp;"+s.commentWpNonceApprove+'" class="dim:the-comment-list:comment-'+s.commentId+':unapproved:e7e7d3:e7e7d3:new=unapproved vim-u" title="'+objectL10n.unapproveThisComment+'">'+objectL10n.unapprove+'</a></span><span class="reply hide-if-no-js"> | <a onclick="commentReply.open( \''+s.commentId+"','"+s.postId+'\' );return false;" class="vim-r" title="'+objectL10n.replyToThisComment+'" href="#">'+objectL10n.reply+'</a></span><span class="quickedit hide-if-no-js"> | <a onclick="commentReply.open( \''+s.commentId+"','"+s.postId+'\',\'edit\' );return false;" class="vim-q" title="'+objectL10n.quickEdit+'" href="#">'+objectL10n.quickEdit+'</a></span><span class="edit"> | <a href="comment.php?action=editcomment&amp;c='+s.commentId+'" title="'+objectL10n.editComment+'">'+objectL10n.edit+'</a></span><span class="spam"> | <a href="comment.php?c='+s.commentId+"&amp;action=spamcomment&amp;"+s.commentWpNonceDel+'" class="delete:the-comment-list:comment-'+s.commentId+'::spam=1 vim-s vim-destructive" title="'+objectL10n.markThisCommentAsSpam+'">'+objectL10n.spam+'</a></span><span class="trash"> | <a href="comment.php?c='+s.commentId+"&amp;action=trashcomment&amp;"+s.commentWpNonceDel+'" class="delete:the-comment-list:comment-'+s.commentId+'::trash=1 delete vim-d vim-destructive" title="'+objectL10n.moveThisCommentToTheTrash+'">'+objectL10n.trash+"</a></span></div></div></div></td></tr>";return F}this.parents=function(){if(u.getData("commentDepth")>1){var C=u.getData("commentDepth")-1;var E=B.list.prevUntil("tr.depth-1","tr:not(.wptc-special-drop)").map(function(F,G){if(c(G).data("wptcCommentObject").getData("commentDepth")==C){C--;return c(G).data("wptcCommentObject")}});if(E.length>0){E.push(c("#comment-"+E[E.length-1].getData("commentId")).prev("tr:not(.wptc-special-drop)").data("wptcCommentObject"))}else{if(u.getData("commentDepth")>1){var D=B.list.prevAll("tr:not(.wptc-special-drop)").first().data("wptcCommentObject");if(D){E.push(D)}}}t.parents=E}else{t.parents=[]}return t.parents};this.expandSubthread=function(){var F=u.subthread();var D=0;var C=0;B.list.find("a.tc-show-more").attr("class","tc-show-less").text(objectL10n.collapse);while(D<u.getData("commentNoc")&&(D<w.expandingMinimum||C<F.length)){F[C].jq().show().addClass("wptc-expanded").find("a.tc-show-more").attr("class","tc-show-less").text(objectL10n.collapse);D++;C++;if(C==F.length&&D<w.expandingMinimum){C=0;var E=F;F=[];c.each(E,function(G,H){var I=H.subthread();c.each(I,function(J,K){F.push(K)})})}}return this};this.collapseSubthread=function(){B.list.find("a.tc-show-less").attr("class","tc-show-more").text(objectL10n.expand);c.each(u.children(),function(C,D){D.jq().hide().removeClass("wptc-expanded").find("a.tc-show-less").attr("class","tc-show-more").text(objectL10n.expand)});return this};function A(C,D){return c.map(C,function(E){if(E.getData("commentDepth")==D){return E}})}this.subthread=function(){return A(u.children(),parseInt(s.commentDepth)+1)};this.jq=function(C){if(!C){C="list"}return B[C]};function r(D,C){var E=false;var F=[];if(C==="parents"){F=parents()}else{F=u.children()}c.each(F,function(G,H){if(H.getData("commentId")==D){E=true;return false}});return E}}function j(w){var x=[];var p=[];var q=c("#"+b.historyButtonsId+"-redo").click(function(z){z.preventDefault();t();return false});var s=c("#"+b.historyButtonsId+"-undo").click(function(z){z.preventDefault();v();return false});function y(){amplify.store.sessionStorage(b.historyStorageItemsName+"-past",x);amplify.store.sessionStorage(b.historyStorageItemsName+"-future",p)}this.restore=function(){var z=amplify.store.sessionStorage(b.historyStorageItemsName+"-past");if(z){x=z}var A=amplify.store.sessionStorage(b.historyStorageItemsName+"-future");if(A){p=A}n();w.wptcDropzone.showhide()};this.put=function(z){x.push({commentId:z.commentId,oldParentId:z.newParentId,oldPostId:z.newPostId,newParentId:z.oldParentId,newPostId:z.oldPostId,commentWpNonceMove:action.commentWpNonceMove,});p=[];y();n();w.wptcDropzone.showhide()};function o(z,A){if(!z||z.toLowerCase()=="past"){if(!A){return x}else{return x.slice(0,A)}}else{if(!A){return p}else{return p.slice(0,A)}}}function n(){if(!p.length){q.attr("disabled","disabled")}else{q.removeAttr("disabled")}if(!x.length){s.attr("disabled","disabled")}else{s.removeAttr("disabled")}}function v(){var z=x.pop();u(z);p.push({commentId:z.commentId,oldParentId:z.newParentId,oldPostId:z.newPostId,newParentId:z.oldParentId,newPostId:z.oldPostId,commentWpNonceMove:z.commentWpNonceMove,});y();n();w.wptcDropzone.showhide()}function t(){var z=p.pop();u(z);x.push({commentId:z.commentId,oldParentId:z.newParentId,oldPostId:z.newPostId,newParentId:z.oldParentId,newPostId:z.oldPostId,commentWpNonceMove:z.commentWpNonceMove,});y();n();w.wptcDropzone.showhide()}function u(B){var E=c("#comment-"+B.commentId);var A=c("#comment-"+B.newParentId);m(B.commentId,B.newParentId,B.newPostId,B.commentWpNonceMove);if(E.length&&A.length){E.wptc().moveTo(A.wptc());w.wptcDropzone.notify(objectL10n.commentWithId+" "+B.commentId+" "+objectL10n.hbReparented);x.pop()}else{if(E.length&&parseInt(B.newPostId)==parseInt(B.oldPostId)&&parseInt(B.newParentId)==0){E.wptc().moveTo(null,"root");w.wptcDropzone.notify(objectL10n.commentWithId+" "+B.commentId+" "+objectL10n.hbMovedToRoot);x.pop()}else{if(A.length){var D=new h(B.commentId,w,function(F,G){F.moveTo(A.wptc());w.wptcDropzone.notify(objectL10n.commentWithId+" "+B.commentId+" "+objectL10n.hbReparented);x.pop()})}else{if(E.length){w.wptcDropzone.notify(objectL10n.commentWithId+" "+B.commentId+" "+objectL10n.hbReparented);E.hide();c.each(E.wptc().children(),function(F,G){G.jq().remove()});var z=E.wptc().parents();var C=E.wptc().getData("commentNoc")+1;c.each(z,function(F,G){G.fixChildren(-C);G.setProperty("children",null)});E.remove()}else{w.wptcDropzone.notify(objectL10n.commentWithId+" "+B.commentId+" "+objectL10n.hbReparented)}}}}}this.empty=function(){return(!x.length&&!p.length)};function r(){x=[];p=[];y();w.wptcDropzone.showhide()}}function f(t){var r=c(this)[0];var q=[];var o=[];this.restore=function(){var u=amplify.store(b.dropzoneStorageItemsName);if(!u){return true}q=c.map(u,function(v){var w=c("#comment-"+v);if(w.length&&w.wptc()){r.put(w.wptc());return w.wptc()}else{return new h(v,t,function(x){x.setProperty("status","dropzone");r.put(x)})}});r.showhide()};function n(){if(!o.length){o=c(s()).insertAfter("#posts-filter .search-box").hide()}if(!o.length){o=c(s()).insertAfter("#comments-form .search-box").hide()}o.droppable({scope:"wptc-comments",drop:function(u,v){v.draggable.wptc().dropTo(null,"dropzone");o.removeClass(b.dropOverClass)},over:function(){o.addClass(b.dropOverClass)},out:function(){o.removeClass(b.dropOverClass)},});c("#wptc-dropzone input[name='wptc-dropzone-all']").click(function(){if(c(this).is(":checked")){c("#wptc-dropzone input:checkbox").attr("checked",true)}else{c("#wptc-dropzone input:checkbox").attr("checked",false)}});c("#wptc-dropzone input:checkbox:not([name='wptc-dropzone-all'])").live("click",function(){c("#wptc-dropzone input[name='wptc-dropzone-all']").attr("checked",false)});return this}function s(){return"<div id='"+b.dropzoneId+"' class='droppable'><ul><li class='wptc-dropzone-header'><span class='comment-cb'><input type='checkbox' name='wptc-dropzone-all' val='all'/></span><span class='wptc-dropzone-title'>"+objectL10n.dropzone+"</span><span class='wptc-history-actions'><button class='button-secondary' id='wptc-history-undo'>"+objectL10n.undo+"</button><button class='button-secondary' id='wptc-history-redo'>"+objectL10n.redo+"</button></span></li><li class='wptc-history-notifications'></li></ul></div>"}this.notify=function(v){var u=c("<span />").appendTo(o.find(".wptc-history-notifications").show());u.text(v);u.delay(1000).fadeOut(2000,function(){u.remove();o.find(".wptc-history-notifications").hide()})};var p=function(){itemsIds=c.map(q,function(u){return u.getData("commentId")});amplify.store(b.dropzoneStorageItemsName,itemsIds)};this.empty=function(){return q.length==0};this.drop=function(u){r.put(u)};this.drag=function(u){remove(u);u.jq().removeClass(b.inDropzoneClass)};this.remove=function(u){commentId=u.getData("commentId");q=c.map(q,function(v){if(v.getData("commentId")!=commentId){return v}});o.find(".dropzone-comment-"+commentId).detach();u.jq().removeClass(b.inDropzoneClass);u.jq().draggable("option","disabled",false);u.setProperty("status","list");c.each(u.children(),function(v,w){w.jq().removeClass(b.inDropzoneClass);w.jq().draggable("option","disabled",false);w.setProperty("status","list")});p();r.showhide()};this.put=function(u){if(!r.isIn(u)){q.push(u)}o.find("ul").append(u.jq("dropzone"));u.jq().addClass(b.inDropzoneClass);u.jq().draggable("option","disabled",true);u.setProperty("status","dropzone");c.each(u.children(),function(v,w){w.jq().addClass(b.inDropzoneClass);w.jq().draggable("option","disabled",true);w.setProperty("status","dropzone")});p();r.showhide()};this.isIn=function(w){var v=w.getData("commentId");for(var u=0;u<q.length;u++){if(v==q[u].getData("commentId")){return true}}return false};this.showhide=function(){if(r.empty()&&t.wptcHistory.empty()){o.hide()}else{o.show()}};this.clear=function(){q=[];o.find("li.comment").remove();c("#the-comment-list tr").removeClass(b.inDropzoneClass);p();showhide()};this.generateHTML=function(u){var w=u.getData();var v=(w.commentText.length>b.numberOfCharactersShown)?"…":"";return commentHTML="<li class='draggable dropzone-comment-"+w.commentId+"'><span class='comment-cb'><input type='checkbox' name='tc-move-comments[]' value='"+w.commentId+"'></span><span class='comment-author'>"+w.commentAuthor+"</span><span class='comment-text'>"+w.commentText.substr(0,b.numberOfCharactersShown)+v+"</span><span class='comment-time'>"+w.commentDateFormatted+"</span></li>"};n()}function k(q){var o=c(this).prev().val();if(o.substr(0,2)=="tc"){q.preventDefault();if(o==b.bulkRmFromToDropzone){c("#wptc-dropzone input:checkbox:checked:not([name='wptc-dropzone-all'])").each(function(){l.wptcDropzone.remove(c(this).closest("li").wptc())});c("#the-comment-list input:checkbox:checked").each(function(){l.wptcDropzone.remove(c(this).closest("tr").wptc())});l.wptcDropzone.showhide()}else{if(o==b.bulkMvToDropzone){c("#the-comment-list input:checkbox:checked").each(function(){var r=c(this).attr("checked",false).val();l.wptcDropzone.put(c("#comment-"+r).wptc())});l.wptcDropzone.showhide()}else{if(o==b.bulkMvTo){var n=c("#the-comment-list input:checkbox:checked").val();var p=c("#comment-"+n).wptc();c("#wptc-dropzone input:checkbox:checked:not([name='wptc-dropzone-all'])").each(function(){c(this).closest("li").wptc().moveTo(p)})}else{if(o==b.bulkMvToRoot){c("#wptc-dropzone input:checkbox:checked:not([name='wptc-dropzone-all'])").each(function(){c(this).closest("li").wptc().moveTo(null,"root")});c("#the-comment-list input:checkbox:checked").each(function(){c(this).closest("tr").wptc().moveTo(null,"root")});l.wptcDropzone.showhide()}}}}c("#wptc-dropzone input, #the-comment-list input").attr("checked",false);return false}}c('select[name="action"]').next().click(k);function g(n,o,p){var r=c("#post-"+n).find(".comment-count");var q=parseInt(r.text());r.text(q-p);r=c("#post-"+o).find(".comment-count");q=parseInt(r.text());r.text(q+p);c("#the-comment-list tr:not(.wptc-special-drop)").each(function(){var u=c(this).find(".post-com-count");if(u.length){var s=c(this).wptc().getData("postId");if(s==n){var v=u.find(".comment-count");var t=parseInt(v.text());v.text(t-p)}else{if(s==o){var v=u.find(".comment-count");var t=parseInt(v.text());v.text(t+p)}}}})}function e(o,t,n){if(n){return true}var p={action:"get-comment-subthread",};var s=c.extend({},p,o);var q={type:"GET",dataType:"JSON",url:ajaxurl,data:s,dataFilter:function(u){return u},timeout:20000,cache:false,};var r=c.extend({},q,t);return c.ajax(r)}function m(q,u,o,n,t){var s={action:"move-comment",single:"false",postid:o,c:q,parent:u,_wpnonce:n,returncommentsubthread:"false",};var p={type:"GET",dataType:"JSON",url:ajaxurl,data:s,dataFilter:function(v){return v},timeout:20000,cache:false,};var r=c.extend({},p,t);return c.ajax(r)}function d(){c("#move-to").suggest(ajaxurl+"?action=search-post-by-title&tax=move-to",{delay:500,minchars:2,multiple:true,multipleSep:" | "});var t=c("input[name='comment_post_ID']").val();var u=c("input[name='comment_ID']").val();var p=window.location.hash.search(/#comment-/i)+9;if(p==8){return}p=parseInt(window.location.hash.substr(p));if(!p){return}var n=c("#comment-"+p).addClass("wptc-inspected");var s=n.wptc();var r=s.children();for(var q=0;q<r.length;q++){r[q].jq().addClass("wptc-inspected-thread")}var o=s.parents();var q=0;while(q<o.length){o[q].expandSubthread();q++}s.expandSubthread()}function i(){this.expandingMinimum=parseInt(c("#wptc-min-expand-setting").val());c("#wptc-min-expand-setting").change(function(){this.expandingMinimum=parseInt(c(this).val());var n=c(this).serialize();n=n+"&action=save_settings-wptc";c.post(ajaxurl,n)})}}})(jQuery);(function(a){jQuery(document).ready(function(){jQuery.ui.draggable.prototype.destroy=function(b,c){};jQuery.ui.droppable.prototype.destroy=function(b,c){};wptcObject=jQuery.wptc();commentReply.show=function(d){var f=this,g,i,h,e,b;f.revert();if(typeof(d)=="string"){f.error({responseText:d});return false}g=wpAjax.parseAjaxResponse(d);if(g.errors){f.error({responseText:wpAjax.broken});return false}g=g.responses[0];i=g.data;h="#comment-"+g.id;if("edit-comment"==f.act){a(h).remove()}if(g.supplemental.parent_approved){b=a("#comment-"+g.supplemental.parent_approved);updatePending(getCount(a("span.pending-count").eq(0))-1);if(this.comments_listing=="moderated"){b.animate({backgroundColor:"#CCEEBB"},400,function(){b.fadeOut()});return}}a(i).hide();a("#replyrow").after(i);a(i).wptc();h=a(h);f.addEvents(h);e=h.hasClass("unapproved")?"#FFFFE0":h.closest(".widefat").css("backgroundColor");h.animate({backgroundColor:"#CCEEBB"},300).animate({backgroundColor:e},300,function(){if(b&&b.length){b.animate({backgroundColor:"#CCEEBB"},300).animate({backgroundColor:e},300).removeClass("unapproved").addClass("approved").find("div.comment_status").html("1")}})}})})(jQuery);